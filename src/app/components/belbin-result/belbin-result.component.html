<!-- Modal de Resultados del Test de Belbin -->
<p-dialog 
    [visible]="visible" 
    [modal]="true" 
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    [style]="{'width': '95vw', 'max-width': '900px', 'max-height': '90vh'}"
    styleClass="belbin-results-dialog"
    (onHide)="onCloseModal()">
    
    <!-- Header personalizado -->
    <ng-template pTemplate="header">
        <div class="flex align-items-center gap-3 w-full">
            <i class="pi pi-trophy text-primary" style="font-size: 1.8rem;"></i>
            <div>
                <h3 class="m-0 font-bold text-primary">¬°Resultados de tu Test Belbin!</h3>
                <p class="m-0 text-sm text-600">Descubre tu perfil de trabajo en equipo</p>
            </div>
        </div>
    </ng-template>
    
    <!-- Contenido principal -->
    <div class="belbin-content" *ngIf="processedData">
        
        <!-- Rol Principal -->
        <div class="primary-role-section mb-4">
            <p-card styleClass="primary-role-card">
                <ng-template pTemplate="header">
                    <div class="text-center py-3">
                        <h4 class="text-primary mb-2">Tu Perfil Principal es:</h4>
                        <i 
                            [class]="processedData.primaryRole.icon" 
                            class="role-icon-large mb-2"
                            [style.color]="processedData.primaryRole.color">
                        </i>
                        <h2 class="text-2xl font-bold m-0" [style.color]="processedData.primaryRole.color">
                            {{ processedData.primaryRole.name }}
                        </h2>
                        <div class="mt-2">
                            <span class="text-lg font-semibold" [style.color]="processedData.primaryRole.color">
                                Puntuaci√≥n: {{ processedData.primaryScore }}
                            </span>
                        </div>
                        <span
                            class="category-tag mt-2"
                            [ngClass]="getCategoryClass(processedData.primaryRole.category)">
                            {{ processedData.primaryRole.category }}
                        </span>
                    </div>
                </ng-template>
                
                <div class="role-description">
                    <div class="mb-3">
                        <h5 class="font-semibold text-900 mb-2">¬øQu√© significa esto?</h5>
                        <p class="text-700 line-height-3">{{ processedData.primaryRole.description }}</p>
                    </div>
                    
                    <div class="mb-3">
                        <h5 class="font-semibold text-900 mb-2">üåü Tus fortalezas principales:</h5>
                        <p class="text-700 line-height-3">{{ processedData.primaryRole.strengths }}</p>
                    </div>
                    
                    <div>
                        <h5 class="font-semibold text-900 mb-2">‚ö†Ô∏è Debilidades permitidas:</h5>
                        <p class="text-600 line-height-3 text-sm">{{ processedData.primaryRole.weaknesses }}</p>
                        <small class="text-500">
                            <i>Nota: Las "debilidades permitidas" son el precio que se paga por tener ciertas fortalezas. 
                            Son naturales y esperadas en tu perfil.</i>
                        </small>
                    </div>
                </div>
            </p-card>
        </div>

        <p-divider></p-divider>

        <!-- Roles Predominantes -->
        <div class="secondary-roles-section mb-4" *ngIf="processedData.secondaryRoles.length > 0">
            <h4 class="text-primary mb-3">
                <i class="pi pi-chart-bar mr-2"></i>
                Roles predominantes adicionales:
            </h4>
            
            <div class="grid">
                <div 
                    class="col-12 md:col-6 lg:col-4" 
                    *ngFor="let secondaryRole of processedData.secondaryRoles">
                    <p-card styleClass="secondary-role-card h-full">
                                                 <div class="text-center mb-3">
                             <i 
                                 [class]="secondaryRole.role.icon" 
                                 class="role-icon-small mb-2"
                                 [style.color]="secondaryRole.role.color">
                             </i>
                             <h6 class="font-semibold m-0" [style.color]="secondaryRole.role.color">
                                 {{ secondaryRole.role.name }}
                             </h6>
                             <small class="text-600">{{ secondaryRole.role.category }}</small>
                         </div>
                        
                        <!-- Puntuaci√≥n num√©rica -->
                        <div class="mb-2">
                            <div class="text-center">
                                <span class="text-xl font-bold" [style.color]="secondaryRole.role.color">
                                    {{ secondaryRole.score }}
                                </span>
                                <small class="text-600 block">puntos</small>
                            </div>
                        </div>
                        
                        <p class="text-sm text-700 line-height-3 m-0">
                            {{ secondaryRole.role.description }}
                        </p>
                    </p-card>
                </div>
            </div>
        </div>

        <!-- Mensaje cuando no hay roles secundarios -->
        <div class="secondary-roles-section mb-4" *ngIf="processedData.secondaryRoles.length === 0 && processedData.primaryScore > 0">
            <div class="bg-yellow-50 p-3 border-round text-center">
                <p class="text-sm text-700 m-0">
                    <i class="pi pi-info-circle mr-2"></i>
                    Solo tu perfil principal ha superado el umbral m√≠nimo requerido.
                    Este es tu rol m√°s destacado y en el que deber√≠as enfocarte.
                </p>
            </div>
        </div>

        <p-divider></p-divider>

        <!-- NUEVA SECCI√ìN: Todos los roles restantes con sus puntuaciones -->
        <div class="all-roles-section mb-4" *ngIf="processedData.allOtherRoles && processedData.allOtherRoles.length > 0">
            <h4 class="text-primary mb-3">
                <i class="pi pi-list mr-2"></i>
                Resultado completo de todos tus roles:
            </h4>

            <div class="bg-blue-50 p-3 border-round mb-3">
                <p class="text-sm text-700 line-height-3 m-0">
                    <i class="pi pi-info-circle mr-2"></i>
                    <strong>Interpretaci√≥n:</strong> Los roles marcados como "predominantes" superan el umbral m√≠nimo establecido.
                    Los dem√°s roles muestran tus tendencias naturales, aunque sean menos dominantes en tu perfil.
                </p>
            </div>

            <div class="grid">
                <div
                    class="col-12 md:col-6 lg:col-4"
                    *ngFor="let roleItem of processedData.allOtherRoles">
                    <p-card
                        [styleClass]="'h-full ' + (roleItem.passesThreshold ? 'all-role-card-prominent' : 'all-role-card-normal')">
                        <div class="text-center mb-3">
                            <i
                                [class]="roleItem.role.icon"
                                class="role-icon-small mb-2"
                                [style.color]="roleItem.role.color">
                            </i>
                            <h6 class="font-semibold m-0" [style.color]="roleItem.role.color">
                                {{ roleItem.role.name }}
                            </h6>
                            <small class="text-600">{{ roleItem.role.category }}</small>

                            <!-- Indicador de si supera umbral -->
                            <div class="mt-2">
                                <span
                                    *ngIf="roleItem.passesThreshold"
                                    class="role-status-badge role-status-prominent">
                                    <i class="pi pi-check-circle mr-1"></i>
                                    Predominante
                                </span>
                                <span
                                    *ngIf="!roleItem.passesThreshold"
                                    class="role-status-badge role-status-secondary">
                                    <i class="pi pi-minus-circle mr-1"></i>
                                    Tendencia natural
                                </span>
                            </div>
                        </div>

                        <!-- Puntuaci√≥n num√©rica -->
                        <div class="mb-2">
                            <div class="text-center">
                                <span class="text-xl font-bold" [style.color]="roleItem.role.color">
                                    {{ roleItem.score }}
                                </span>
                                <small class="text-600 block">puntos</small>
                            </div>
                        </div>

                        <p class="text-sm text-700 line-height-3 m-0">
                            {{ roleItem.role.description }}
                        </p>
                    </p-card>
                </div>
            </div>
        </div>

        <p-divider></p-divider>

        <!-- Informaci√≥n adicional -->
        <div class="additional-info mb-4">
            <h4 class="text-primary mb-3">
                <i class="pi pi-info-circle mr-2"></i>
                ¬øDe d√≥nde salen estos resultados?
            </h4>
            
            <div class="bg-blue-50 p-3 border-round mb-3">
                <p class="text-sm text-700 line-height-3 m-0">
                    <strong>Investigaci√≥n cient√≠fica:</strong> Estos resultados se basan en la investigaci√≥n del Dr. Meredith Belbin 
                    realizada durante 9 a√±os en el Henley Management College. Se estudiaron equipos reales trabajando en 
                    simulaciones empresariales para identificar qu√© comportamientos llevan al √©xito.
                </p>
            </div>
            
            <div class="bg-green-50 p-3 border-round mb-3">
                <p class="text-sm text-700 line-height-3 m-0">
                    <strong>Validez mundial:</strong> Los 9 Roles de Equipo de Belbin son utilizados por m√°s del 40% de las 
                    empresas del top 100 en Reino Unido, las Naciones Unidas, el Banco Mundial y miles de organizaciones 
                    en todo el mundo.
                </p>
            </div>
            
            <div class="bg-orange-50 p-3 border-round">
                <p class="text-sm text-700 line-height-3 m-0">
                    <strong>¬øQu√© hacer ahora?</strong> Conocer tu perfil te ayuda a entender tus fortalezas naturales y 
                    encontrar el lugar adecuado en un equipo. Trabaja con compa√±eros que complementen tus habilidades 
                    y aprovecha al m√°ximo lo que aportas de forma √∫nica.
                </p>
            </div>
        </div>

        <!-- Mensaje personalizado si hay email -->
        <div *ngIf="userEmail" class="user-message mb-4">
            <div class="bg-purple-50 p-3 border-round text-center">
                <p class="text-sm text-700 m-0">
                    <i class="pi pi-user mr-2"></i>
                    <strong>{{ userEmail }}</strong> - Este perfil ha sido guardado en tu cuenta para futuras referencias.
                </p>
            </div>
        </div>
    </div>
    
    <!-- Footer con acciones -->
    <ng-template pTemplate="footer">
        <div class="text-center">
            <div class="mb-3">
                <div class="countdown-display mb-2">
                    <i class="pi pi-clock mr-2"></i>
                    <span class="countdown-number">{{ redirectCountdown }}</span>
                </div>
                <p class="text-sm text-600 m-0">
                    Redirecci√≥n autom√°tica al dashboard en {{ redirectCountdown }} segundos...
                </p>
            </div>
            <p-button 
                label="Ir al Dashboard Ahora" 
                icon="pi pi-arrow-right" 
                severity="primary"
                size="large"
                styleClass="continue-button"
                (onClick)="onCloseModal()">
            </p-button>
        </div>
    </ng-template>
</p-dialog> 