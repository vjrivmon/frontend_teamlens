<header class="flex align-items-center gap-6">
    <div class="cursor-pointer" routerLink="/home">
        <h1 class="text-5xl">team<span class="text-gradient">lens</span></h1>
    </div>
    @if (loggedUser) {
        <a class="ui basic button" routerLink="/dashboard">
            Dashboard
        </a>
    }    
    <div class="flex gap-2 ml-auto" style="align-items: center;">
        @if (loggedUser) {
            <!-- Contenedor del sistema de notificaciones enterprise -->
            <div class="notifications-container" style="position: relative;">
                <!-- Icono de notificaciones con indicador inteligente -->
                <i [class]="getNotificationIconClass()" 
                   [ngClass]="{ 
                     'notification': (unreadCount$ | async) && (unreadCount$ | async)! > 0,
                     'has-notifications': hasNotifications$ | async
                   }" 
                   (click)="toggleNotificationPanel()"
                   title="Notificaciones">
                   
                    <!-- Badge dinámico de notificaciones no leídas -->
                    <span class="notification-badge" 
                          *ngIf="(unreadCount$ | async) && (unreadCount$ | async)! > 0">
                        {{ (unreadCount$ | async)! > 99 ? '99+' : (unreadCount$ | async) }}
                    </span>
                </i>

                <!-- Panel de notificaciones enterprise -->
                <app-notifications-panel
                    [isOpen]="notificationPanelOpen"
                    [maxHeight]="'500px'"
                    [showFilters]="true"
                    (onClose)="closeNotificationPanel()"
                    (onNotificationClick)="onNotificationClick($event)">
                </app-notifications-panel>
            </div>                   
            <i class="big user circle icon h-100" style="color: whitesmoke;"></i>
            <div class="" style="display: flex; flex-direction: column; justify-content: center; align-items: start;">
                <b>{{ loggedUser.name }}</b>
                <i>{{ loggedUser.email }}</i>
            </div>           
            <div class="ml-4">
                <a class="ui button primary basic" (click)="showLogoutDialog = true">
                    Cerrar Sesión
                </a>
            </div>
        }
        @else {
            <div class="item">
                <a class="ui basic primary button" routerLink="/register">
                    Registrarse como Profesor
                </a>
            </div>
            <div class="item">
                <a class="ui primary button" routerLink="/login">
                    Iniciar Sesión
                </a>
            </div>
        }
    </div>
</header>

<!-- Diálogo de confirmación de logout -->
<p-dialog 
    header="Confirmar Cierre de Sesión" 
    [(visible)]="showLogoutDialog" 
    [modal]="true"
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    [style]="{'width': '400px', 'max-width': '90vw'}"
    styleClass="logout-dialog">
    
    <div class="flex flex-column gap-3 py-3">
        <div class="flex align-items-center gap-3">
            <div class="flex align-items-center justify-content-center w-3rem h-3rem bg-orange-50 border-round">
                <i class="pi pi-sign-out text-orange-600 text-xl"></i>
            </div>
            <div>
                <h4 class="m-0 text-900">¿Estás seguro de que deseas cerrar sesión?</h4>
                <p class="m-0 text-600 mt-1">Se perderá cualquier trabajo no guardado.</p>
            </div>
        </div>
    </div>
    
    <ng-template pTemplate="footer">
        <div class="flex gap-2 justify-content-end">
            <p-button 
                label="Cancelar" 
                icon="pi pi-times"
                class="p-button-outlined"
                (onClick)="showLogoutDialog = false">
            </p-button>
            <p-button 
                label="Cerrar Sesión" 
                icon="pi pi-sign-out"
                severity="danger"
                (onClick)="confirmLogout()">
            </p-button>
        </div>
    </ng-template>
</p-dialog>