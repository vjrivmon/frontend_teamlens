<div class="container">
    <div id="profile">
        <h1 class="text-5xl">{{loggedUser?.name}}</h1>
        <p-chip label="{{loggedUser?.role == 'teacher' ? 'Profesor' : 'Estudiante'}}" class="role-chip"
            [styleClass]="loggedUser?.role == 'teacher' ? 'bg-primary' : ''" />
    </div>

    <p-divider />

    <div id="activities">
        <h1>Actividades</h1>
        <p>
            @if(loggedUser?.role == 'teacher') {
                Estas son las actividades grupales que estás gestionando.
            } @else {
                Estas son las actividades en las que participas.
            }
        </p>
        @if(activities.length == 0) {
        <p>Aún no hay actividades.</p>
        }
        <div class="activities-list">
            @for (activity of (activities); track $index) {
            <div (click)="goToActivityDetail(activity._id)" class="app-card flex flex-column gap-2">
                <span class="title">
                    {{ activity.title }}
                </span>
                <span class="subtitle">
                    <!-- organitzation -->
                    UPV
                </span>
                <p>
                    {{ activity.description }}
                </p>
            </div>
            }
            <div teacherOnly>
                <div class="app-card-new flex flex-column gap-2" (click)="onCreateActivityButton()">
                    <i class="pi pi-plus text-500"></i>
                    Crear actividad
                </div>
            </div>
        </div>

        <p-dialog header="Crear una actividad" [modal]="true" [(visible)]="createActivityDialogVisible"
            [style]="{ width: '35rem' }">
            <app-create-activity (onActivityCreated)="onActivityCreated($event)"></app-create-activity>
        </p-dialog>

    </div>

    <div studentOnly>
        @if(studentGroups.length > 0) {
            <p-divider />
            <h3>Mis Grupos</h3>
            <p>Estos son los grupos a los que perteneces.</p>
            <div class="flex gap-3 flex-wrap">
                @for (item of studentGroups; track $index) {
                    <div class="app-card flex flex-column gap-2">
                        <span class="title">{{ item.group.name }}</span>
                        <span class="subtitle">{{ item.activityTitle }}</span>
                        <p>{{ item.group.students?.length || 0 }} integrantes</p>
                        @if(item.group.status === 'confirmed') {
                            <p-chip label="Confirmado" styleClass="bg-green-100" />
                        } @else {
                            <p-chip label="Borrador" />
                        }
                    </div>
                }
            </div>
        }

        <p-divider />

        <h3>Cuestionarios</h3>
        @if(questionnaires.length == 0) {
        <p>Aún no hay cuestionarios.</p>
        }
        <div class="flex gap-3 flex-wrap">
            @for (questionnaire of questionnaires; track $index) {
                @if (questionnaire.enabled) {
                    <div class="flex gap-2 questionnaire-card">
                        <div class="ui card p-4 m-0">
                            <h3>{{ questionnaire.title }}</h3>
                            <p>{{ questionnaire.description | slice:0:60 }}
                                @if(questionnaire.description.length > 50) {
                                ...
                                }
                            </p>
                            <p>{{ questionnaire.questions.length }} preguntas.</p>
                            <div class="flex gap-2">
                                @if(hasAskedQuestionnaire(questionnaire._id) != undefined) {
                                <button disabled class="ui button">Ya respondido</button>
                                <button class="ui button primary basic" (click)="onAskQuestionnaireButton(questionnaire)">Responder de nuevo</button>
                                }@else {
                                <button class="ui button primary" (click)="onAskQuestionnaireButton(questionnaire)">Responder</button>
                                }
                            </div>
                        </div>
                        @if(questionnaire.questionnaireType == 'BELBIN' && hasAskedQuestionnaire(questionnaire._id) != undefined) {
                        <div class="role-result-panel">
                            @switch (hasAskedQuestionnaire(questionnaire._id)?.result) {
                                @case ("CO") {
                                    <img class="role-img"
                                        src="https://www.belbin.com/media/3284/co-icon.png?width=83&height=106&mode=crop&format=webp&quality=80"
                                        alt="Coordinador">
                                    <p>Coordinador</p>
                                }
                                @case ("SH") {
                                    <img class="role-img"
                                        src="https://www.belbin.com/media/3289/sh-icon.png?width=83&height=106&mode=crop&format=webp&quality=80"
                                        alt="Impulsor">
                                    <p>Impulsor</p>
                                }
                                @case("RI"){
                                    <img class="role-img"
                                        src="https://www.belbin.com/media/3288/ri-icon.png?width=83&height=106&mode=crop&format=webp&quality=80"
                                        alt="Investigador de Recursos">
                                    <p>Investigador de Recursos</p>
                                }
                                @case ("PL") {
                                    <img class="role-img"
                                        src="https://www.belbin.com/media/3287/pl-icon.png?width=83&height=106&mode=crop&format=webp&quality=80"
                                        alt="Cerebro">
                                    <p>Cerebro</p>
                                }
                                @case ("TW") {
                                    <img class="role-img"
                                        src="https://www.belbin.com/media/3291/tw-icon.png?width=83&height=106&mode=crop&format=webp&quality=80"
                                        alt="Cohesionador">
                                    <p>Cohesionador</p>
                                }
                                @case ("IM") {
                                    <img class="role-img"
                                        src="https://www.belbin.com/media/3285/imp-icon.png?width=83&height=106&mode=crop&format=webp&quality=80"
                                        alt="Implementador">
                                    <p>Implementador</p>
                                }
                                @case ("CF") {
                                    <img class="role-img"
                                        src="https://www.belbin.com/media/3283/cf-icon.png?width=83&height=106&mode=crop&format=webp&quality=80"
                                        alt="Finalizador">
                                    <p>Finalizador</p>
                                }
                                @case ("ME") {
                                    <img class="role-img"
                                        src="https://www.belbin.com/media/3286/me-icon.png?width=83&height=106&mode=crop&format=webp&quality=80"
                                        alt="Evaluador">
                                    <p>Evaluador</p>
                                }
                                @case ("SP") {
                                    <img class="role-img"
                                        src="https://www.belbin.com/media/3290/sp-icon.png?width=83&height=106&mode=crop&format=webp&quality=80"
                                        alt="Especialista">
                                    <p>Especialista</p>
                                }
                            }
                            <a href="https://www.belbin.com/about/belbin-team-roles">Más información...</a>
                        </div>
                        }
                    </div>

                }
            

            }

        </div>
    </div>

</div>